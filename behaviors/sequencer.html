<link rel="import" href="../../polymer/polymer-element.html">

<script>
    class Sequencer extends Polymer.Element {
        static get properties() {
            return {
                steps: {
                    type: Array,
                    value: () => {
                        return [0,0,0,0,0,0,0,0];
                    },
                    notify: true
                },
                stepCount: {
                    type: Number,
                    value: 8,
                    observer: '_observeStepCount'
                },
                stepIndex: {
                    type: Number,
                    value: 0,
                    notify: true
                },
                gate: {
                    type: Number,
                    value: 0,
                    observer: '_observeGate'
                },
                threshold: {
                    type: Number,
                    value: 0.5
                },
                output: {
                    type: Number,
                    computed: '_computeOutput(stepIndex, steps.*)',
                    notify: true
                }
            }
        }
        _observeGate (current, previous) {
            // if (current > this.threshold && previous < this.threshold) {
            if (current > this.threshold) {
                let nextStep = (this.stepIndex + 1) % this.stepCount;
                this.set('stepIndex', nextStep);
            }
        }
        _observeStepCount (current) {
            if (current > this.steps.length) {
                for (let i = this.steps.length; i < current; i++) {
                    this.push('steps', 0);
                }
            } else if (current < this.steps.length) {
                let extra = this.steps.length - current;
                this.splice('steps', this.steps.length - extra, extra);
            }
        }
        _computeOutput(index, steps) {
            return steps.base[index];
        }
    }
</script>
